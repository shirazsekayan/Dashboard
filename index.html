import React, { useState, useEffect } from 'react';

const ScorecardDashboard = () => {
  // Add custom scrollbar styles
  useEffect(() => {
    const styleElement = document.createElement('style');
    const isDark = theme === 'dark';
    
    styleElement.innerHTML = `
      /* Beautiful Custom Scrollbar Styles for ${theme} mode */
      * {
        scrollbar-width: thin !important;
        scrollbar-color: ${isDark ? '#8b5cf6 rgba(15, 23, 42, 0.8)' : '#6366f1 rgba(226, 232, 240, 0.8)'} !important;
      }

      *::-webkit-scrollbar {
        width: 12px !important;
        height: 12px !important;
      }

      *::-webkit-scrollbar-track {
        background: ${isDark ? 'rgba(15, 23, 42, 0.8)' : 'rgba(226, 232, 240, 0.8)'} !important;
        border-radius: 8px !important;
      }

      *::-webkit-scrollbar-thumb {
        background: ${isDark ? 'linear-gradient(180deg, #a78bfa 0%, #8b5cf6 100%)' : 'linear-gradient(180deg, #818cf8 0%, #6366f1 100%)'} !important;
        border-radius: 8px !important;
        border: 2px solid ${isDark ? 'rgba(15, 23, 42, 0.5)' : 'rgba(255, 255, 255, 0.5)'} !important;
      }

      *::-webkit-scrollbar-thumb:hover {
        background: ${isDark ? 'linear-gradient(180deg, #c4b5fd 0%, #a78bfa 100%)' : 'linear-gradient(180deg, #a5b4fc 0%, #818cf8 100%)'} !important;
      }

      *::-webkit-scrollbar-corner {
        background: ${isDark ? 'rgba(15, 23, 42, 0.8)' : 'rgba(226, 232, 240, 0.8)'} !important;
      }
    `;
    document.head.appendChild(styleElement);
    
    return () => {
      if (document.head.contains(styleElement)) {
        document.head.removeChild(styleElement);
      }
    };
  }, [theme]);

  useEffect(() => {
    localStorage.setItem('dashboardTheme', theme);
  }, [theme]);

  // Clear any corrupted localStorage on first load
  useEffect(() => {
    try {
      const saved = localStorage.getItem('scorecardData');
      if (saved) {
        const parsed = JSON.parse(saved);
        // Check if min/max exist, if not, we need to reset
        if (parsed.quarters && parsed.quarters['Q1-2026'] && !parsed.quarters['Q1-2026'].min) {
          console.log('Clearing old data format...');
          localStorage.removeItem('scorecardData');
          window.location.reload();
        }
      }
    } catch (e) {
      console.log('Clearing corrupted data...');
      localStorage.removeItem('scorecardData');
    }
  }, []);

  const [view, setView] = useState('landing');
  const [activeTab, setActiveTab] = useState('goals');
  
  const initialData = {
    quarters: {
      'Q1-2026': { 
        goals: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        min: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        max: { bankDeposit: 65000, production: 100000, yelpReview: 20, googleReview: 20, newPatients: 20 },
        weeks: {}
      },
      'Q2-2026': { 
        goals: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        min: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        max: { bankDeposit: 65000, production: 100000, yelpReview: 20, googleReview: 20, newPatients: 20 },
        weeks: {}
      },
      'Q3-2026': { 
        goals: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        min: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        max: { bankDeposit: 65000, production: 100000, yelpReview: 20, googleReview: 20, newPatients: 20 },
        weeks: {}
      },
      'Q4-2026': { 
        goals: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        min: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        max: { bankDeposit: 65000, production: 100000, yelpReview: 20, googleReview: 20, newPatients: 20 },
        weeks: {}
      },
      'EOY-2026': { 
        goals: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        min: { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 },
        max: { bankDeposit: 65000, production: 100000, yelpReview: 20, googleReview: 20, newPatients: 20 },
        weeks: {}
      }
    },
    customMetrics: []
  };

  const [data, setData] = useState(initialData);
  const [customMetrics, setCustomMetrics] = useState([]);
  const [defaultMetrics, setDefaultMetrics] = useState([
    { key: 'bankDeposit', label: 'Bank Deposit', icon: 'üí∞', color: '#10b981', prefix: '$', isCustom: false },
    { key: 'production', label: 'Production', icon: 'üìä', color: '#3b82f6', prefix: '$', isCustom: false },
    { key: 'yelpReview', label: 'Yelp Reviews', icon: '‚≠ê', color: '#ef4444', prefix: '', isCustom: false },
    { key: 'googleReview', label: 'Google Reviews', icon: '‚≠ê', color: '#eab308', prefix: '', isCustom: false },
    { key: 'newPatients', label: 'New Patients', icon: 'üë•', color: '#a855f7', prefix: '', isCustom: false }
  ]);
  
  const [selectedQuarter, setSelectedQuarter] = useState('Q1-2026');
  const [editMode, setEditMode] = useState(false);
  const [editValues, setEditValues] = useState({});
  const [editMinValues, setEditMinValues] = useState({});
  const [editMaxValues, setEditMaxValues] = useState({});
  const [selectedWeek, setSelectedWeek] = useState(null);
  const [weeklyEditMode, setWeeklyEditMode] = useState(false);
  const [weeklyEditValues, setWeeklyEditValues] = useState({});
  const [deleteConfirm, setDeleteConfirm] = useState(null);
  const [showCustomMetricModal, setShowCustomMetricModal] = useState(false);
  const [showManageWidgetsModal, setShowManageWidgetsModal] = useState(false);
  const [deleteMetricConfirm, setDeleteMetricConfirm] = useState(null);
  const [theme, setTheme] = useState(() => {
    const savedTheme = localStorage.getItem('dashboardTheme');
    return savedTheme || 'dark';
  });
  const [newMetric, setNewMetric] = useState({
    name: '',
    icon: 'üìä',
    color: '#3b82f6',
    prefix: '',
    defaultMin: 0,
    defaultMax: 100
  });

  useEffect(() => {
    try {
      const dataToSave = { ...data, customMetrics, defaultMetrics };
      localStorage.setItem('scorecardData', JSON.stringify(dataToSave));
    } catch (e) {
      console.error('Error saving data:', e);
    }
  }, [data, customMetrics, defaultMetrics]);

  useEffect(() => {
    try {
      const saved = localStorage.getItem('scorecardData');
      if (saved) {
        const parsed = JSON.parse(saved);
        setData(parsed);
        if (parsed.customMetrics) {
          setCustomMetrics(parsed.customMetrics);
        }
        if (parsed.defaultMetrics) {
          setDefaultMetrics(parsed.defaultMetrics);
        }
      }
    } catch (e) {
      console.error('Error loading:', e);
    }
  }, []);

  const allMetrics = [...defaultMetrics, ...customMetrics];

  const themeColors = {
    dark: {
      background: 'linear-gradient(135deg, #1e293b 0%, #0f172a 100%)',
      cardBg: 'rgba(255, 255, 255, 0.05)',
      cardBorder: 'rgba(255, 255, 255, 0.1)',
      text: 'white',
      textSecondary: '#94a3b8',
      textTertiary: '#64748b',
      inputBg: 'rgba(15, 23, 42, 0.5)',
      inputBorder: '#334155',
      modalBg: 'rgba(30, 41, 59, 0.95)',
      modalOverlay: 'rgba(0, 0, 0, 0.7)'
    },
    light: {
      background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',
      cardBg: 'rgba(255, 255, 255, 0.9)',
      cardBorder: 'rgba(203, 213, 225, 0.5)',
      text: '#0f172a',
      textSecondary: '#475569',
      textTertiary: '#64748b',
      inputBg: 'rgba(255, 255, 255, 0.9)',
      inputBorder: '#cbd5e1',
      modalBg: 'rgba(255, 255, 255, 0.98)',
      modalOverlay: 'rgba(0, 0, 0, 0.5)'
    }
  };

  const colors = themeColors[theme];

  if (view === 'landing') {
    return (
      <div style={{ minHeight: '100vh', background: colors.background, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', fontFamily: 'system-ui, sans-serif' }}>
        <div style={{ width: '100%', maxWidth: '400px', background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '24px', padding: '40px' }}>
          <div style={{ textAlign: 'center', marginBottom: '32px' }}>
            <div style={{ display: 'inline-flex', width: '80px', height: '80px', background: 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)', borderRadius: '16px', marginBottom: '16px', fontSize: '32px', alignItems: 'center', justifyContent: 'center' }}>üìã</div>
            <h1 style={{ fontSize: '28px', fontWeight: 'bold', color: colors.text, marginBottom: '8px' }}>Scorecard Dashboard</h1>
            <p style={{ color: colors.textSecondary }}>2026 Quarterly Goals & Weekly Check-ins</p>
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
            <button onClick={() => setView('admin')} style={{ width: '100%', background: 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)', color: 'white', padding: '14px', borderRadius: '12px', fontSize: '16px', fontWeight: '600', border: 'none', cursor: 'pointer' }}>
              üëë Enter as Admin
            </button>
            <button onClick={() => setView('viewer')} style={{ width: '100%', background: 'rgba(51, 65, 85, 0.5)', color: '#cbd5e1', padding: '14px', borderRadius: '12px', fontSize: '16px', fontWeight: '600', border: 'none', cursor: 'pointer' }}>
              üëÅÔ∏è View Team Scorecards
            </button>
          </div>
        </div>
      </div>
    );
  }

  const calculateTotals = () => {
    try {
      const weeks = data.quarters[selectedQuarter]?.weeks || {};
      const totals = { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 };
      Object.values(weeks).forEach(week => {
        if (week) {
          totals.bankDeposit += Number(week.bankDeposit) || 0;
          totals.production += Number(week.production) || 0;
          totals.yelpReview += Number(week.yelpReview) || 0;
          totals.googleReview += Number(week.googleReview) || 0;
          totals.newPatients += Number(week.newPatients) || 0;
        }
      });
      return totals;
    } catch (e) {
      return { bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0 };
    }
  };

  const addWeeklyCheckIn = () => {
    const weekNumber = Object.keys(data.quarters[selectedQuarter].weeks).length + 1;
    const weekKey = `Week ${weekNumber}`;
    const newWeeks = { ...data.quarters[selectedQuarter].weeks };
    newWeeks[weekKey] = {
      bankDeposit: 0, production: 0, yelpReview: 0, googleReview: 0, newPatients: 0,
      date: new Date().toLocaleDateString()
    };
    const newQuarters = { ...data.quarters };
    newQuarters[selectedQuarter] = { ...data.quarters[selectedQuarter], weeks: newWeeks };
    setData({ ...data, quarters: newQuarters });
  };

  const handleDeleteWeek = (weekKey) => {
    const currentWeeks = { ...data.quarters[selectedQuarter].weeks };
    delete currentWeeks[weekKey];
    const newQuarters = { ...data.quarters };
    newQuarters[selectedQuarter] = { ...data.quarters[selectedQuarter], weeks: currentWeeks };
    setData({ ...data, quarters: newQuarters });
    setDeleteConfirm(null);
  };

  const startWeeklyEdit = (weekKey) => {
    setSelectedWeek(weekKey);
    setWeeklyEditValues({ ...data.quarters[selectedQuarter].weeks[weekKey] });
    setWeeklyEditMode(true);
  };

  const saveWeeklyEdit = () => {
    const newWeeks = { ...data.quarters[selectedQuarter].weeks };
    newWeeks[selectedWeek] = { ...weeklyEditValues };
    const newQuarters = { ...data.quarters };
    newQuarters[selectedQuarter] = { ...data.quarters[selectedQuarter], weeks: newWeeks };
    setData({ ...data, quarters: newQuarters });
    setWeeklyEditMode(false);
    setSelectedWeek(null);
  };

  const availableEmojis = [
    'üìä', 'üí∞', '‚≠ê', 'üë•', 'üéØ', 'üìà', 'üíµ', 'üèÜ', '‚ú®', 'üî•',
    'üí°', 'üì±', 'üíª', 'üöÄ', '‚ö°', 'üé®', 'üìû', '‚úÖ', 'üéÅ', 'üåü',
    'üí™', 'üèÖ', 'üìù', 'üí¨', 'üìß', 'üîî', '‚è∞', 'üìÖ', 'üéâ', 'üëç',
    '‚ù§Ô∏è', 'üîµ', 'üü¢', 'üü°', 'üü£', 'üü†', 'üî¥', '‚ö™', '‚ö´', 'üü§'
  ];

  const availableColors = [
    { name: 'Blue', value: '#3b82f6' },
    { name: 'Green', value: '#10b981' },
    { name: 'Red', value: '#ef4444' },
    { name: 'Yellow', value: '#eab308' },
    { name: 'Purple', value: '#a855f7' },
    { name: 'Pink', value: '#ec4899' },
    { name: 'Orange', value: '#f97316' },
    { name: 'Teal', value: '#14b8a6' },
    { name: 'Cyan', value: '#06b6d4' },
    { name: 'Indigo', value: '#6366f1' }
  ];

  const addCustomMetric = () => {
    if (!newMetric.name.trim()) {
      alert('Please enter a metric name');
      return;
    }

    const metricKey = newMetric.name.toLowerCase().replace(/\s+/g, '_');
    
    // Check if metric already exists
    if (defaultMetrics.some(m => m.key === metricKey) || customMetrics.some(m => m.key === metricKey)) {
      alert('A metric with this name already exists');
      return;
    }

    const customMetric = {
      key: metricKey,
      label: newMetric.name,
      icon: newMetric.icon,
      color: newMetric.color,
      prefix: newMetric.prefix,
      isCustom: true
    };

    // Add to custom metrics
    setCustomMetrics([...customMetrics, customMetric]);

    // Initialize values for all quarters
    const newQuarters = { ...data.quarters };
    Object.keys(newQuarters).forEach(quarter => {
      newQuarters[quarter].goals[metricKey] = 0;
      newQuarters[quarter].min[metricKey] = newMetric.defaultMin;
      newQuarters[quarter].max[metricKey] = newMetric.defaultMax;
      
      // Add to existing weeks
      Object.keys(newQuarters[quarter].weeks).forEach(weekKey => {
        newQuarters[quarter].weeks[weekKey][metricKey] = 0;
      });
    });

    setData({ ...data, quarters: newQuarters });

    // Reset form
    setNewMetric({
      name: '',
      icon: 'üìä',
      color: '#3b82f6',
      prefix: '',
      defaultMin: 0,
      defaultMax: 100
    });
    setShowCustomMetricModal(false);
  };

  const deleteMetric = (metricKey, isCustom) => {
    // Remove from appropriate list
    if (isCustom) {
      setCustomMetrics(customMetrics.filter(m => m.key !== metricKey));
    } else {
      setDefaultMetrics(defaultMetrics.filter(m => m.key !== metricKey));
    }

    // Remove from all quarters
    const newQuarters = { ...data.quarters };
    Object.keys(newQuarters).forEach(quarter => {
      delete newQuarters[quarter].goals[metricKey];
      delete newQuarters[quarter].min[metricKey];
      delete newQuarters[quarter].max[metricKey];
      
      // Remove from weeks
      Object.keys(newQuarters[quarter].weeks).forEach(weekKey => {
        delete newQuarters[quarter].weeks[weekKey][metricKey];
      });
    });

    setData({ ...data, quarters: newQuarters });
  };

  const reorderAllMetrics = (direction, index) => {
    const allMetricsCopy = [...allMetrics];
    
    if (direction === 'up' && index > 0) {
      [allMetricsCopy[index], allMetricsCopy[index - 1]] = [allMetricsCopy[index - 1], allMetricsCopy[index]];
    } else if (direction === 'down' && index < allMetrics.length - 1) {
      [allMetricsCopy[index], allMetricsCopy[index + 1]] = [allMetricsCopy[index + 1], allMetricsCopy[index]];
    } else {
      return; // No change needed
    }

    // Split back into default and custom
    const newDefaultMetrics = allMetricsCopy.filter(m => !m.isCustom);
    const newCustomMetrics = allMetricsCopy.filter(m => m.isCustom);
    
    setDefaultMetrics(newDefaultMetrics);
    setCustomMetrics(newCustomMetrics);
  };

  const SpeedometerGauge = ({ value, max, min, color, prefix }) => {
    const safeValue = Number(value) || 0;
    const safeMax = Number(max) || 100;
    const safeMin = Number(min) || 0;
    const range = safeMax - safeMin;
    const adjustedValue = Math.max(safeMin, Math.min(safeValue, safeMax));
    const percentage = range > 0 ? ((adjustedValue - safeMin) / range) * 100 : 0;
    const angle = (percentage / 100) * 180 - 90;
    
    return (
      <div style={{ width: '100%' }}>
        <div style={{ position: 'relative', width: '100%', paddingTop: '55%', marginBottom: '16px' }}>
          <svg viewBox="0 0 200 110" style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }}>
            <path d="M 20 90 A 80 80 0 0 1 180 90" fill="none" stroke="rgba(255, 255, 255, 0.1)" strokeWidth="18" strokeLinecap="round" />
            <path d="M 20 90 A 80 80 0 0 1 180 90" fill="none" stroke={color} strokeWidth="18" strokeLinecap="round"
              strokeDasharray={`${(percentage / 100) * 251.2} 251.2`} style={{ transition: 'stroke-dasharray 0.5s ease' }} />
            {[0, 25, 50, 75, 100].map(tick => {
              const tickAngle = (tick / 100) * 180 - 90;
              const tickRadians = (tickAngle * Math.PI) / 180;
              return (
                <line key={tick}
                  x1={100 + Math.cos(tickRadians) * 72} y1={90 + Math.sin(tickRadians) * 72}
                  x2={100 + Math.cos(tickRadians) * 78} y2={90 + Math.sin(tickRadians) * 78}
                  stroke="rgba(255, 255, 255, 0.3)" strokeWidth="2" />
              );
            })}
            <circle cx="100" cy="90" r="6" fill="rgba(255, 255, 255, 0.2)" />
            <line x1="100" y1="90" x2="100" y2="25" stroke={color} strokeWidth="3" strokeLinecap="round"
              transform={`rotate(${angle} 100 90)`} style={{ transition: 'transform 0.5s ease' }} />
            <circle cx="100" cy="90" r="8" fill={color} />
          </svg>
        </div>
        <div style={{ textAlign: 'center', marginBottom: '12px' }}>
          <div style={{ fontSize: '36px', fontWeight: 'bold', color: colors.text }}>{prefix}{safeValue.toLocaleString()}</div>
          <div style={{ fontSize: '13px', color: '#94a3b8', marginTop: '6px' }}>{percentage.toFixed(1)}% of range</div>
        </div>
        <div style={{ display: 'flex', justifyContent: 'space-between', paddingTop: '8px', borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}>
          <div>
            <div style={{ fontSize: '11px', color: '#64748b' }}>MIN</div>
            <div style={{ fontSize: '14px', color: '#94a3b8', fontWeight: '600' }}>{prefix}{safeMin.toLocaleString()}</div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <div style={{ fontSize: '11px', color: '#64748b' }}>MAX</div>
            <div style={{ fontSize: '14px', color: '#94a3b8', fontWeight: '600' }}>{prefix}{safeMax.toLocaleString()}</div>
          </div>
        </div>
      </div>
    );
  };

  const ProgressBar = ({ current, goal, color, prefix }) => {
    const safeCurrent = Number(current) || 0;
    const safeGoal = Number(goal) || 1;
    const percentage = Math.min((safeCurrent / safeGoal) * 100, 100);
    const isOnTrack = percentage >= 50;
    
    return (
      <div style={{ width: '100%' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
          <span style={{ fontSize: '14px', color: '#94a3b8' }}>{prefix}{safeCurrent.toLocaleString()} / {prefix}{safeGoal.toLocaleString()}</span>
          <span style={{ fontSize: '12px', fontWeight: '600', color: isOnTrack ? '#10b981' : '#f59e0b' }}>{percentage.toFixed(0)}%</span>
        </div>
        <div style={{ width: '100%', height: '12px', background: 'rgba(255, 255, 255, 0.1)', borderRadius: '6px', overflow: 'hidden' }}>
          <div style={{ width: `${percentage}%`, height: '100%', background: color, borderRadius: '6px', transition: 'width 0.5s ease' }} />
        </div>
      </div>
    );
  };

  const isAdmin = view === 'admin';
  const currentGoals = data.quarters[selectedQuarter]?.goals || {};
  const currentMin = data.quarters[selectedQuarter]?.min || {};
  const currentMax = data.quarters[selectedQuarter]?.max || {};
  const currentValues = editMode ? editValues : currentGoals;
  const totals = calculateTotals();
  const weekEntries = Object.entries(data.quarters[selectedQuarter]?.weeks || {});

  return (
    <div style={{ minHeight: '100vh', background: colors.background, padding: '24px', fontFamily: 'system-ui, sans-serif', transition: 'background 0.3s ease' }}>
      {/* Header */}
      <div style={{ maxWidth: '1400px', margin: '0 auto 32px' }}>
        <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '24px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '16px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
            <div style={{ width: '56px', height: '56px', background: 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '28px' }}>üìã</div>
            <div>
              <h1 style={{ fontSize: '24px', fontWeight: 'bold', color: colors.text, margin: 0 }}>2026 Scorecard Dashboard</h1>
              <p style={{ color: colors.textSecondary, margin: 0 }}>{isAdmin ? 'üëë Admin Mode' : 'üëÅÔ∏è View Only'}</p>
            </div>
          </div>
          <div style={{ display: 'flex', gap: '12px' }}>
            <button 
              onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} 
              style={{ padding: '10px 20px', background: theme === 'dark' ? '#fbbf24' : '#1e293b', color: theme === 'dark' ? '#0f172a' : '#f1f5f9', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500', display: 'flex', alignItems: 'center', gap: '8px' }}>
              {theme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark'}
            </button>
            <button onClick={() => { setView('landing'); setActiveTab('goals'); }} style={{ padding: '10px 20px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>üö™ Logout</button>
          </div>
        </div>
      </div>

      {/* Quarter Selection */}
      <div style={{ maxWidth: '1400px', margin: '0 auto 32px' }}>
        <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '24px' }}>
          <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#cbd5e1', marginBottom: '12px' }}>Select Period</label>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '12px' }}>
            {Object.keys(data.quarters).map(quarter => (
              <button key={quarter} onClick={() => { setSelectedQuarter(quarter); setEditMode(false); setActiveTab('goals'); }}
                style={{ padding: '12px 16px', borderRadius: '12px', fontSize: '15px', fontWeight: '600', border: 'none', cursor: 'pointer',
                  background: selectedQuarter === quarter ? 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)' : 'rgba(51, 65, 85, 0.5)', color: colors.text }}>{quarter}</button>
            ))}
          </div>
        </div>
      </div>

      {/* Tab Navigation */}
      <div style={{ maxWidth: '1400px', margin: '0 auto 24px' }}>
        <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '8px', display: 'flex', gap: '8px' }}>
          <button onClick={() => setActiveTab('goals')} style={{ flex: 1, padding: '12px 24px', borderRadius: '10px', fontSize: '15px', fontWeight: '600', border: 'none', cursor: 'pointer',
            background: activeTab === 'goals' ? 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)' : 'transparent', color: colors.text }}>üéØ Quarterly Goals</button>
          <button onClick={() => setActiveTab('weekly')} style={{ flex: 1, padding: '12px 24px', borderRadius: '10px', fontSize: '15px', fontWeight: '600', border: 'none', cursor: 'pointer',
            background: activeTab === 'weekly' ? 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)' : 'transparent', color: colors.text }}>üìÖ Weekly Check-ins</button>
        </div>
      </div>

      {/* Goals Tab */}
      {activeTab === 'goals' && (
        <div>
          {isAdmin && (
            <div style={{ maxWidth: '1400px', margin: '0 auto 32px' }}>
              <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '16px', display: 'flex', justifyContent: 'space-between', gap: '12px' }}>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <button onClick={() => setShowCustomMetricModal(true)} style={{ padding: '10px 24px', background: '#8b5cf6', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>‚ûï Add Custom Widget</button>
                  <button onClick={() => setShowManageWidgetsModal(true)} style={{ padding: '10px 24px', background: '#6366f1', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>‚öôÔ∏è Manage Widgets</button>
                </div>
                <div style={{ display: 'flex', gap: '12px' }}>
                  {!editMode ? (
                    <button onClick={() => { setEditValues({ ...currentGoals }); setEditMinValues({ ...currentMin }); setEditMaxValues({ ...currentMax }); setEditMode(true); }}
                      style={{ padding: '10px 24px', background: '#3b82f6', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>‚úèÔ∏è Edit Goals, Min & Max</button>
                  ) : (
                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button onClick={() => setEditMode(false)} style={{ padding: '10px 24px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>Cancel</button>
                      <button onClick={() => { 
                        const newData = {...data}; 
                        newData.quarters[selectedQuarter].goals = {...editValues}; 
                        newData.quarters[selectedQuarter].min = {...editMinValues}; 
                        newData.quarters[selectedQuarter].max = {...editMaxValues}; 
                        setData(newData); 
                        setEditMode(false); 
                      }} style={{ padding: '10px 24px', background: '#10b981', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>üíæ Save All</button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}

          <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(320px, 1fr))', gap: '24px' }}>
              {allMetrics.map(metric => {
                const value = currentValues[metric.key] || 0;
                const minValue = (editMode ? editMinValues : currentMin)[metric.key] || 0;
                const maxValue = (editMode ? editMaxValues : currentMax)[metric.key] || 100;
                
                return (
                  <div key={metric.key} style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '24px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '20px' }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <div style={{ width: '48px', height: '48px', background: metric.color + '20', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px' }}>{metric.icon}</div>
                        <h3 style={{ color: colors.text, fontSize: '16px', fontWeight: '600', margin: 0 }}>{metric.label}</h3>
                      </div>
                      {editMode && isAdmin && <span style={{ fontSize: '20px' }}>‚úèÔ∏è</span>}
                    </div>
                    
                    {editMode && isAdmin ? (
                      <div>
                        <div style={{ marginBottom: '16px' }}>
                          <label style={{ display: 'block', fontSize: '13px', color: '#94a3b8', marginBottom: '8px' }}>Goal Value</label>
                          <input type="number" value={value} onChange={(e) => setEditValues({ ...editValues, [metric.key]: parseFloat(e.target.value) || 0 })}
                            style={{ width: '100%', fontSize: '24px', fontWeight: 'bold', color: colors.text, background: 'rgba(15, 23, 42, 0.5)', border: '2px solid #334155', borderRadius: '8px', padding: '12px 16px', outline: 'none', boxSizing: 'border-box' }} />
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                          <div>
                            <label style={{ display: 'block', fontSize: '12px', color: '#64748b', marginBottom: '6px' }}>Minimum</label>
                            <input type="number" value={minValue} 
                              onChange={(e) => setEditMinValues({ ...editMinValues, [metric.key]: parseFloat(e.target.value) || 0 })}
                              style={{ width: '100%', fontSize: '16px', fontWeight: '600', color: colors.text, background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '6px', padding: '8px 12px', outline: 'none', boxSizing: 'border-box' }} />
                          </div>
                          <div>
                            <label style={{ display: 'block', fontSize: '12px', color: '#64748b', marginBottom: '6px' }}>Maximum</label>
                            <input type="number" value={maxValue} 
                              onChange={(e) => setEditMaxValues({ ...editMaxValues, [metric.key]: parseFloat(e.target.value) || 0 })}
                              style={{ width: '100%', fontSize: '16px', fontWeight: '600', color: colors.text, background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '6px', padding: '8px 12px', outline: 'none', boxSizing: 'border-box' }} />
                          </div>
                        </div>
                      </div>
                    ) : (
                      <SpeedometerGauge value={value} max={maxValue} min={minValue} color={metric.color} prefix={metric.prefix} />
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      )}

      {/* Weekly Tab - Continuing in next message due to length */}
      {activeTab === 'weekly' && (
        <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
          <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '24px', marginBottom: '24px' }}>
            <h2 style={{ color: colors.text, fontSize: '18px', fontWeight: '600', margin: '0 0 20px 0' }}>üìä Progress Towards {selectedQuarter} Goals</h2>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '20px' }}>
              {allMetrics.map(metric => (
                <div key={metric.key}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px' }}>
                    <span style={{ fontSize: '20px' }}>{metric.icon}</span>
                    <span style={{ color: colors.text, fontSize: '14px', fontWeight: '600' }}>{metric.label}</span>
                  </div>
                  <ProgressBar current={totals[metric.key]} goal={currentGoals[metric.key] || 0} color={metric.color} prefix={metric.prefix} />
                </div>
              ))}
            </div>
          </div>

          {isAdmin && (
            <div style={{ marginBottom: '24px' }}>
              <button onClick={addWeeklyCheckIn} style={{ padding: '12px 24px', background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', color: colors.text, borderRadius: '12px', border: 'none', cursor: 'pointer', fontSize: '15px', fontWeight: '600' }}>‚ûï Add Weekly Check-in</button>
            </div>
          )}

          <div style={{ display: 'grid', gap: '20px' }}>
            {weekEntries.length === 0 ? (
              <div style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '48px 24px', textAlign: 'center' }}>
                <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìÖ</div>
                <h3 style={{ color: colors.text, fontSize: '18px', fontWeight: '600', margin: '0 0 8px 0' }}>No weekly check-ins yet</h3>
                <p style={{ color: '#94a3b8', fontSize: '14px', margin: 0 }}>{isAdmin ? 'Click "Add Weekly Check-in" to start!' : 'Admin needs to add check-ins.'}</p>
              </div>
            ) : (
              weekEntries.map(([weekKey, weekData]) => {
                if (!weekData) return null;
                return (
                  <div key={weekKey} style={{ background: colors.cardBg, backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '24px' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                      <div>
                        <h3 style={{ color: colors.text, fontSize: '18px', fontWeight: '600', margin: '0 0 4px 0' }}>{weekKey}</h3>
                        <p style={{ color: '#94a3b8', fontSize: '13px', margin: 0 }}>{weekData.date || 'No date'}</p>
                      </div>
                      {isAdmin && (
                        <div style={{ display: 'flex', gap: '8px' }}>
                          {weeklyEditMode && selectedWeek === weekKey ? (
                            <>
                              <button onClick={() => { setWeeklyEditMode(false); setSelectedWeek(null); }} style={{ padding: '8px 16px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' }}>Cancel</button>
                              <button onClick={saveWeeklyEdit} style={{ padding: '8px 16px', background: '#10b981', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' }}>üíæ Save</button>
                            </>
                          ) : (
                            <>
                              <button onClick={() => startWeeklyEdit(weekKey)} style={{ padding: '8px 16px', background: '#3b82f6', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' }}>‚úèÔ∏è Edit</button>
                              {deleteConfirm === weekKey ? (
                                <>
                                  <button onClick={() => handleDeleteWeek(weekKey)} style={{ padding: '8px 16px', background: '#dc2626', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '700' }}>‚úì Confirm</button>
                                  <button onClick={() => setDeleteConfirm(null)} style={{ padding: '8px 16px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' }}>Cancel</button>
                                </>
                              ) : (
                                <button onClick={() => setDeleteConfirm(weekKey)} style={{ padding: '8px 16px', background: '#ef4444', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '13px', fontWeight: '500' }}>üóëÔ∏è Delete</button>
                              )}
                            </>
                          )}
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>
                      {allMetrics.map(metric => {
                        const value = weeklyEditMode && selectedWeek === weekKey ? (weeklyEditValues[metric.key] || 0) : (weekData[metric.key] || 0);
                        return (
                          <div key={metric.key} style={{ background: 'rgba(255, 255, 255, 0.03)', padding: '16px', borderRadius: '12px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px' }}>
                              <span style={{ fontSize: '18px' }}>{metric.icon}</span>
                              <span style={{ color: '#94a3b8', fontSize: '13px', fontWeight: '500' }}>{metric.label}</span>
                            </div>
                            {weeklyEditMode && selectedWeek === weekKey ? (
                              <input type="number" value={value} onChange={(e) => setWeeklyEditValues({ ...weeklyEditValues, [metric.key]: parseFloat(e.target.value) || 0 })}
                                style={{ width: '100%', fontSize: '20px', fontWeight: 'bold', color: colors.text, background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '6px', padding: '8px 12px', outline: 'none', boxSizing: 'border-box' }} />
                            ) : (
                              <div style={{ fontSize: '24px', fontWeight: 'bold', color: colors.text }}>{metric.prefix}{Number(value).toLocaleString()}</div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </div>
      )}

      {/* Custom Metric Modal */}
      {showCustomMetricModal && (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0, 0, 0, 0.7)', backdropFilter: 'blur(4px)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', zIndex: 1000 }}>
          <div style={{ background: 'rgba(30, 41, 59, 0.95)', backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '32px', maxWidth: '500px', width: '100%' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
              <div style={{ width: '48px', height: '48px', background: 'rgba(139, 92, 246, 0.2)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px' }}>‚ûï</div>
              <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: colors.text, margin: 0 }}>Create Custom Widget</h3>
            </div>
            
            <div style={{ marginBottom: '16px' }}>
              <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Widget Name</label>
              <input 
                type="text" 
                value={newMetric.name} 
                onChange={(e) => setNewMetric({ ...newMetric, name: e.target.value })}
                placeholder="e.g., Phone Calls, Conversions..."
                style={{ width: '100%', padding: '12px', background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '8px', color: colors.text, fontSize: '16px', outline: 'none', boxSizing: 'border-box' }} 
              />
            </div>

            <div style={{ marginBottom: '16px' }}>
              <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Select Icon</label>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(10, 1fr)', gap: '8px', maxHeight: '200px', overflowY: 'auto', padding: '8px', background: 'rgba(15, 23, 42, 0.3)', borderRadius: '8px' }}>
                {availableEmojis.map(emoji => (
                  <button
                    key={emoji}
                    onClick={() => setNewMetric({ ...newMetric, icon: emoji })}
                    style={{ 
                      padding: '8px', 
                      background: newMetric.icon === emoji ? 'rgba(139, 92, 246, 0.3)' : 'rgba(51, 65, 85, 0.3)', 
                      border: newMetric.icon === emoji ? '2px solid #8b5cf6' : '1px solid #334155', 
                      borderRadius: '6px', 
                      cursor: 'pointer', 
                      fontSize: '20px',
                      transition: 'all 0.2s'
                    }}
                  >
                    {emoji}
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '16px' }}>
              <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Select Color</label>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '8px' }}>
                {availableColors.map(colorOption => (
                  <button
                    key={colorOption.value}
                    onClick={() => setNewMetric({ ...newMetric, color: colorOption.value })}
                    style={{ 
                      padding: '12px', 
                      background: colorOption.value, 
                      border: newMetric.color === colorOption.value ? '3px solid white' : 'none', 
                      borderRadius: '8px', 
                      cursor: 'pointer',
                      fontSize: '12px',
                      color: colors.text,
                      fontWeight: '600'
                    }}
                    title={colorOption.name}
                  >
                    {newMetric.color === colorOption.value && '‚úì'}
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '16px' }}>
              <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Prefix (optional)</label>
              <input 
                type="text" 
                value={newMetric.prefix} 
                onChange={(e) => setNewMetric({ ...newMetric, prefix: e.target.value })}
                placeholder="e.g., $ or leave empty"
                maxLength={3}
                style={{ width: '100%', padding: '12px', background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '8px', color: colors.text, fontSize: '16px', outline: 'none', boxSizing: 'border-box' }} 
              />
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '24px' }}>
              <div>
                <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Default Min</label>
                <input 
                  type="number" 
                  value={newMetric.defaultMin} 
                  onChange={(e) => setNewMetric({ ...newMetric, defaultMin: parseFloat(e.target.value) || 0 })}
                  style={{ width: '100%', padding: '12px', background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '8px', color: colors.text, fontSize: '16px', outline: 'none', boxSizing: 'border-box' }} 
                />
              </div>
              <div>
                <label style={{ display: 'block', fontSize: '14px', color: '#cbd5e1', marginBottom: '8px', fontWeight: '500' }}>Default Max</label>
                <input 
                  type="number" 
                  value={newMetric.defaultMax} 
                  onChange={(e) => setNewMetric({ ...newMetric, defaultMax: parseFloat(e.target.value) || 0 })}
                  style={{ width: '100%', padding: '12px', background: 'rgba(15, 23, 42, 0.5)', border: '1px solid #334155', borderRadius: '8px', color: colors.text, fontSize: '16px', outline: 'none', boxSizing: 'border-box' }} 
                />
              </div>
            </div>
            
            <div style={{ display: 'flex', gap: '12px' }}>
              <button 
                onClick={() => setShowCustomMetricModal(false)} 
                style={{ flex: 1, padding: '12px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>
                Cancel
              </button>
              <button 
                onClick={addCustomMetric} 
                style={{ flex: 1, padding: '12px', background: '#8b5cf6', color: colors.text, borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>
                Create Widget
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Manage Widgets Modal */}
      {showManageWidgetsModal && (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(0, 0, 0, 0.7)', backdropFilter: 'blur(4px)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px', zIndex: 1000 }}>
          <div style={{ background: 'rgba(30, 41, 59, 0.95)', backdropFilter: 'blur(10px)', border: `1px solid ${colors.cardBorder}`, borderRadius: '16px', padding: '32px', maxWidth: '600px', width: '100%', maxHeight: '80vh', overflowY: 'auto' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>
              <div style={{ width: '48px', height: '48px', background: 'rgba(99, 102, 241, 0.2)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px' }}>‚öôÔ∏è</div>
              <h3 style={{ fontSize: '20px', fontWeight: 'bold', color: colors.text, margin: 0 }}>Manage All Widgets</h3>
            </div>

            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px', marginBottom: '24px' }}>
              {allMetrics.map((metric, index) => (
                <div key={metric.key} style={{ background: 'rgba(51, 65, 85, 0.3)', border: `1px solid ${colors.cardBorder}`, borderRadius: '12px', padding: '16px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '16px', flex: 1 }}>
                    <div style={{ width: '48px', height: '48px', background: metric.color + '20', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px' }}>{metric.icon}</div>
                    <div style={{ flex: 1 }}>
                      <h4 style={{ color: colors.text, fontSize: '16px', fontWeight: '600', margin: '0 0 4px 0' }}>
                        {metric.label}
                        {!metric.isCustom && <span style={{ marginLeft: '8px', fontSize: '11px', padding: '2px 8px', background: 'rgba(59, 130, 246, 0.2)', color: '#60a5fa', borderRadius: '4px', fontWeight: '500' }}>DEFAULT</span>}
                      </h4>
                      <div style={{ display: 'flex', gap: '12px', fontSize: '13px', color: '#94a3b8' }}>
                        <span>Prefix: {metric.prefix || 'None'}</span>
                      </div>
                    </div>
                  </div>
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <button 
                      onClick={() => reorderAllMetrics('up', index)}
                      disabled={index === 0}
                      style={{ 
                        padding: '8px 12px', 
                        background: index === 0 ? 'rgba(51, 65, 85, 0.5)' : '#334155', 
                        color: index === 0 ? '#64748b' : '#cbd5e1', 
                        borderRadius: '6px', 
                        border: 'none', 
                        cursor: index === 0 ? 'not-allowed' : 'pointer', 
                        fontSize: '16px' 
                      }}>
                      ‚Üë
                    </button>
                    <button 
                      onClick={() => reorderAllMetrics('down', index)}
                      disabled={index === allMetrics.length - 1}
                      style={{ 
                        padding: '8px 12px', 
                        background: index === allMetrics.length - 1 ? 'rgba(51, 65, 85, 0.5)' : '#334155', 
                        color: index === allMetrics.length - 1 ? '#64748b' : '#cbd5e1', 
                        borderRadius: '6px', 
                        border: 'none', 
                        cursor: index === allMetrics.length - 1 ? 'not-allowed' : 'pointer', 
                        fontSize: '16px' 
                      }}>
                      ‚Üì
                    </button>
                    {deleteMetricConfirm === metric.key ? (
                      <>
                        <button 
                          onClick={() => {
                            deleteMetric(metric.key, metric.isCustom);
                            setDeleteMetricConfirm(null);
                          }}
                          style={{ padding: '8px 12px', background: '#dc2626', color: colors.text, borderRadius: '6px', border: 'none', cursor: 'pointer', fontSize: '12px', fontWeight: '700' }}>
                          ‚úì Confirm
                        </button>
                        <button 
                          onClick={() => setDeleteMetricConfirm(null)}
                          style={{ padding: '8px 12px', background: '#334155', color: '#cbd5e1', borderRadius: '6px', border: 'none', cursor: 'pointer', fontSize: '12px', fontWeight: '500' }}>
                          Cancel
                        </button>
                      </>
                    ) : (
                      <button 
                        onClick={() => setDeleteMetricConfirm(metric.key)}
                        style={{ padding: '8px 12px', background: '#ef4444', color: colors.text, borderRadius: '6px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>
                        üóëÔ∏è
                      </button>
                    )}
                  </div>
                </div>
              ))}
            </div>

            <div style={{ borderTop: '1px solid rgba(255, 255, 255, 0.1)', paddingTop: '16px', marginTop: '16px' }}>
              <p style={{ color: '#94a3b8', fontSize: '13px', marginBottom: '16px' }}>
                üí° Use arrow buttons to reorder any widget. The üóëÔ∏è button deletes widgets (both default and custom). <strong style={{ color: '#cbd5e1' }}>Changes apply to all quarters!</strong>
              </p>
              <button 
                onClick={() => setShowManageWidgetsModal(false)} 
                style={{ width: '100%', padding: '12px', background: '#334155', color: '#cbd5e1', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500' }}>
                Close
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

 export default function App() {
     return <ScorecardDashboard />;
   }
/* Add this CSS for custom scrollbar styling - will be injected into the component */
const scrollbarStyles = `
  <style>
    /* Custom Scrollbar Styles */
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(139, 92, 246, 0.5) rgba(30, 41, 59, 0.3);
    }

    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    *::-webkit-scrollbar-track {
      background: rgba(30, 41, 59, 0.3);
      border-radius: 4px;
    }

    *::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 4px;
      transition: background 0.
